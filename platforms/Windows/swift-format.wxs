<Wix
    xmlns="http://wixtoolset.org/schemas/v4/wxs"
    xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package
      Language="1033"
      Manufacturer="swift.org"
      Name="Swift Code Formatter"
      UpgradeCode="45f1ae7a-4d90-414d-80b3-a5a45898b212"
      Version="$(var.ProductVersion)"
      Scope="perMachine">
    <SummaryInformation Description="Swift Code Formatter" />

    <Media Id="1" Cabinet="fmt.cab" EmbedCab="yes" />

    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLDIR" Name="Swift">
        <Directory Id="Tools" Name="Tools">
          <Directory Id="_" Name="swift-format">
            <Directory Id="_usr" Name="usr">
              <Directory Id="_usr_bin" Name="bin" />
            </Directory>
          </Directory>
        </Directory>
      </Directory>
    </StandardDirectory>

    <Component Directory="_usr_bin" Id="swift_format.exe">
      <File Id="swift_format.exe" Source="$(var.SWIFT_FORMAT_BUILD)\swift-format.exe" Checksum="yes" KeyPath="yes" />
    </Component>

    <ComponentGroup Id="EnvironmentVariables">
      <Component Id="SystemEnvironmentVariables" Condition="ALLUSERS=1" Directory="INSTALLDIR" Guid="c1a01e55-3353-4eca-8b58-9960e57a3758">
        <Environment Id="SystemPath" Action="set" Name="Path" Part="last" Permanent="no" System="yes" Value="[INSTALLDIR]Tools\swift-format\usr\bin" />
      </Component>
      <Component Id="UserEnvironmentVariables" Condition="NOT ALLUSERS=1" Directory="INSTALLDIR" Guid="ee0f5c7a-8101-4a75-96ed-95a78e40ac5c">
        <Environment Id="UserPath" Action="set" Name="Path" Part="last" Permanent="no" System="no" Value="[INSTALLDIR]Tools\swift-format\usr\bin" />
      </Component>
    </ComponentGroup>

    <Feature Id="SwiftFormat" AllowAbsent="yes" AllowAdvertise="yes" ConfigurableDirectory="INSTALLDIR" Description="Swift Code Formatter" Level="1" Title="swift-format">
      <ComponentRef Id="swift_format.exe" />
      <ComponentGroupRef Id="EnvironmentVariables" />
    </Feature>

    <UI>
      <ui:WixUI Id="WixUI_InstallDir" />
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg" Order="2" />
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2" />
    </UI>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"></Property>

    <WixVariable Id="WixUIDialogBmp" Value="Resources\swift_dialog.png" />
    <WixVariable Id="WixUIBannerBmp" Value="Resources\swift_banner.png" />
  </Package>
</Wix>
