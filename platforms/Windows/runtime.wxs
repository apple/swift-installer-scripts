<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <?include config.wxi?>
  <Package
      Language="1033"
      Manufacturer="swift.org"
      Name="!(loc.Runtime_ProductName_$(var.ProcessorArchitecture))"
      UpgradeCode="bea8c6dc-f73e-445b-9486-2333d1cf2886"
      Version="$(var.ProductVersion)"
      Scope="perMachine">

    <MediaTemplate CabinetTemplate="rt{0}.cab" />

    <ComponentGroup Id="stdlib" Directory="_usr_bin">
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swift_Concurrency.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swift_Differentiation.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftDistributed.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swift_RegexParser.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swift_StringProcessing.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftCore.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftCxx.dll" />
      </Component>

      <!-- TODO(compnerd) should we distribute the undecoration library in the runtime?
      <Component Directory="_usr_bin" Id="swiftDemangle.dll">
        <File Id="swiftDemangle.dll" Source="$(var.SDK_ROOT)\bin\swiftDemangle.dll" />
      </Component>
      -->
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftCRT.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftRemoteMirror.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftSwiftOnoneSupport.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftWinSDK.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="BlocksRuntime" Directory="_usr_bin">
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\BlocksRuntime.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="libdispatch" Directory="_usr_bin">
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\dispatch.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\swiftDispatch.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="Foundation" Directory="_usr_bin">
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\Foundation.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\FoundationNetworking.dll" />
      </Component>
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\FoundationXML.dll" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="plutil" Directory="_usr_bin">
      <Component>
        <File Source="$(var.SDK_ROOT)\usr\bin\plutil.exe" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="EnvironmentVariables" Directory="INSTALLDIR">
      <Component Id="SystemEnvironmentVariables" Condition="ALLUSERS=1" Guid="8681d813-eb32-46f9-8b1c-f622b38b5eaf">
        <Environment Id="SystemPath" Action="set" Name="Path" Part="last" Permanent="no" System="yes" Value="[_usr_bin]" />
      </Component>
      <Component Id="UserEnvironmentVariables" Condition="NOT ALLUSERS=1" Guid="b83f6521-8708-4e2d-afef-076d8cdd7528">
        <Environment Id="UserPath" Action="set" Name="Path" Part="last" Permanent="no" System="no" Value="[_usr_bin]" />
      </Component>
    </ComponentGroup>

    <!-- Feature -->
    <Feature Id="SwiftRuntime" AllowAbsent="no" ConfigurableDirectory="INSTALLDIR" Title="Swift Windows Runtime ($(var.ProcessorArchitecture))">
      <ComponentGroupRef Id="stdlib" />
      <ComponentGroupRef Id="BlocksRuntime" />
      <ComponentGroupRef Id="libdispatch" />
      <ComponentGroupRef Id="Foundation" />

      <ComponentGroupRef Id="EnvironmentVariables" />
    </Feature>

    <Feature Id="SwiftUtilities" AllowAbsent="yes" Title="!(loc.Runtime_ProductName_$(var.ProcessorArchitecture))">
      <ComponentGroupRef Id="plutil" />
    </Feature>
  </Package>
</Wix>
