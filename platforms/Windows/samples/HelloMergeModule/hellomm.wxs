<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

  <?if $(sys.BUILDARCH) == x64 ?>
    <?define MergeModuleFileName = "rtl.amd64.msm" ?>
  <?else?>
    <?define MergeModuleFileName = "rtl.$(sys.BUILDARCH).msm" ?>
  <?endif?>

  <Package
      Id="*"
      Language="1033"
      Manufacturer="swift.org"
      Name="Hello Merge Module World"
      UpgradeCode="C0050D86-A62E-41CD-844D-DF3501C4B5F1"
      Version="1.0"
      InstallerVersion="500"
      Compressed="yes"
      InstallScope="perMachine">

    <MediaTemplate EmbedCab="yes" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="!(bind.property.ProductName)">
          <Merge Id="swift_runtime" Language="0" SourceFile="$(RedistributablesDirectory)\$(MergeModuleFileName)" />
        </Directory>
      </Directory>
    </Directory>

    <Feature Id="MainFeature" Title="!(bind.property.ProductName)" Level="1">
      <MergeRef Id="swift_runtime" />
      <ComponentRef Id="MainExecutableComponent" />
    </Feature>

    <Component Id="MainExecutableComponent" Directory="INSTALLFOLDER">
      <File Source="hello.exe" />
    </Component>
  </Package>
</Wix>
