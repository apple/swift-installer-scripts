<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal">
  <Bundle
    Name="!(loc.BundleName) $(ProductVersion)"
    Version="$(ProductVersion)"
    IconSourceFile="logo.ico"
    Manufacturer="!(loc.ManufacturerName)"
    DisableModify="yes"
    Compressed="$(IsBundleCompressed)"
    UpgradeCode="$(BundleUpgradeCode)">

    <!-- Log configuration -->
    <Log Prefix="SwiftToolKit_$(ProductVersion)" />

    <BootstrapperApplication>
      <bal:WixStandardBootstrapperApplication
        LicenseUrl="https://www.swift.org/LICENSE.txt"
        Theme="hyperlinkSidebarLicense"
        LocalizationFile="..\shared\swift.en-us.wxl"
        ThemeFile="theme.xml" />
      <Payload SourceFile="swift_side.png" />
    </BootstrapperApplication>

    <!-- Variables -->
    <Variable Name="InstallRoot" bal:Overridable="yes" Type="formatted" Persisted="yes"
      Value="[LocalAppDataFolder]Programs\Swift" />
    <Variable Name="OptionsInstallCli" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallDbg" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallIde" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallSdkX86" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallRedistX86" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallSdkAMD64" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallRedistAMD64" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallSdkArm64" bal:Overridable="yes" Persisted="yes" Value="1" />
    <Variable Name="OptionsInstallRedistArm64" bal:Overridable="yes" Persisted="yes" Value="1" />

    <!-- Chain -->
    <Chain>
      <!-- MsiPackages -->
      <MsiPackage
        SourceFile="!(bindpath.rtl)\rtl.msi"
        DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
        <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
      </MsiPackage>

      <MsiPackage
        SourceFile="!(bindpath.bld)\bld.msi"
        DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
        <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
      </MsiPackage>

      <MsiPackage
        SourceFile="!(bindpath.cli)\cli.msi"
        InstallCondition="OptionsInstallCli"
        DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
        <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
      </MsiPackage>

      <MsiPackage
        SourceFile="!(bindpath.dbg)\dbg.msi"
        InstallCondition="OptionsInstallDbg"
        DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
        <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
      </MsiPackage>

      <MsiPackage
        SourceFile="!(bindpath.ide)\ide.msi"
        InstallCondition="OptionsInstallIde"
        DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
        <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
      </MsiPackage>

      <!-- Optional X86 SDK -->
      <?if $(INCLUDE_X86_SDK) == true?>
        <MsiPackage
          SourceFile="!(bindpath.sdk_x86)\sdk.x86.msi"
          InstallCondition="OptionsInstallSdkX86"
          DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
          <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
          <MsiProperty Name="INSTALLREDIST" Value="[OptionsInstallRedistX86]" />
        </MsiPackage>
      <?endif?>

      <!-- AMD64 SDK -->
      <MsiPackage
        SourceFile="!(bindpath.sdk_amd64)\sdk.amd64.msi"
        InstallCondition="OptionsInstallSdkAMD64"
        DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
        <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
        <MsiProperty Name="INSTALLREDIST" Value="[OptionsInstallRedistAMD64]" />
      </MsiPackage>

      <!-- Optional ARM64 SDK -->
      <?if $(INCLUDE_ARM64_SDK) == true ?>
        <MsiPackage
          SourceFile="!(bindpath.sdk_arm64)\sdk.arm64.msi"
          InstallCondition="OptionsInstallSdkArm64"
          DownloadUrl="$(BaseReleaseDownloadUrl)/{2}">
          <MsiProperty Name="INSTALLROOT" Value="[InstallRoot]" />
          <MsiProperty Name="INSTALLREDIST" Value="[OptionsInstallRedistArm64]" />
        </MsiPackage>
      <?endif?>
    </Chain>
  </Bundle>
</Wix>
