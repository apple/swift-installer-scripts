<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Language="1033" Manufacturer="swift.org" Name="Swift ICU for Windows x86_64" UpgradeCode="4b3bfcaf-46b1-4940-b3e3-692ea4e78a09" Version="$(var.ProductVersion)">
    <Package Comments="Copyright (c) 2021-2022 Swift Open Source Project" Compressed="yes" Description="Swift ICU for Windows x86_64" InstallScope="perMachine" Manufacturer="swift.org" />

    <Media Id="1" Cabinet="icu.cab" EmbedCab="yes" />
    <?ifdef INCLUDE_DEBUG_INFO ?>
    <Media Id="2" Cabinet="PDBs.cab" EmbedCab="yes" />
    <?endif?>

    <!-- Directory Structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="INSTALLDIR">
        <Directory Id="_" Name="icu-$(var.ProductVersion)">
          <Directory Id="_usr" Name="usr">
            <Directory Id="_usr_bin" Name="bin">
            </Directory>
          </Directory>
        </Directory>
      </Directory>
    </Directory>

    <SetDirectory Id="INSTALLDIR" Value="[ProgramFiles64Folder]swift">
      NOT INSTALLDIR
    </SetDirectory>

    <!-- Components -->
    <ComponentGroup Id="ICU" Directory="_usr_bin">
      <Component Id="icudt.dll" Guid="0fcd685e-e7be-4f00-874e-160b1b0bc45b">
        <File Id="icudt.dll" Source="$(var.ICU_ROOT)\Library\icu-$(var.ProductVersion)\usr\bin\icudt$(var.ProductVersionMajor).dll" Checksum="yes" />
      </Component>
      <Component Id="icuin.dll" Guid="d7c9b71a-df54-4c6d-9f8f-18273322f0dc">
        <File Id="icuin.dll" Source="$(var.ICU_ROOT)\Library\icu-$(var.ProductVersion)\usr\bin\icuin$(var.ProductVersionMajor).dll" Checksum="yes" />
      </Component>
      <Component Id="icuuc.dll" Guid="d9abc6db-1cd1-4ab8-b762-1fde12b3a741">
        <File Id="icuuc.dll" Source="$(var.ICU_ROOT)\Library\icu-$(var.ProductVersion)\usr\bin\icuuc$(var.ProductVersionMajor).dll" Checksum="yes" />
      </Component>
    </ComponentGroup>

    <?ifdef INCLUDE_DEBUG_INFO ?>
    <ComponentGroup Id="ICUDebugInfo" Directory="_usr_bin">
      <Component Id="icuin.pdb" Guid="ba918d12-3c1a-49fc-b67a-e63577a772bb">
        <File Id="icuin.pdb" Source="$(var.ICU_ROOT)\Library\icu-$(var.ProductVersion)\usr\bin\icuin$(var.ProductVersionMajor).pdb" Checksum="yes" DiskId="2" />
      </Component>
      <Component Id="icuuc.pdb" Guid="c0a0d274-0dd2-4e2d-931e-bbedbbd57bf0">
        <File Id="icuuc.pdb" Source="$(var.ICU_ROOT)\Library\icu-$(var.ProductVersion)\usr\bin\icuuc$(var.ProductVersionMajor).pdb" Checksum="yes" DiskId="2" />
      </Component>
    </ComponentGroup>
    <?endif ?>

    <DirectoryRef Id="TARGETDIR">
      <Component Id="EnvironmentVariables" Guid="97fe0a23-32e0-481d-8827-215f4c74f03c">
        <Environment Id="Path" Action="set" Name="Path" Part="last" Permanent="no" System="yes" Value="[INSTALLDIR]icu-$(var.ProductVersion)\usr\bin" />
      </Component>
    </DirectoryRef>

    <!-- Features -->
    <Feature Id="WinX64ICU" Absent="disallow" AllowAdvertise="yes" ConfigurableDirectory="INSTALLDIR" Description="Swift ICU for Windows x86_64" Level="1" Title="Swift ICU for Windows x86_64">
      <ComponentGroupRef Id="ICU" />
      <ComponentRef Id="EnvironmentVariables" />

      <?ifdef INCLUDE_DEBUG_INFO ?>
      <Feature Id="DebugInfo" Absent="allow" AllowAdvertise="yes" Description="Debug Information for Swift ICU for Windows x86_64" Level="0" Title="Debug Information">
        <Condition Level="1">INSTALL_DEBUGINFO</Condition>
        <ComponentGroupRef Id="ICUDebugInfo" />
      </Feature>
      <?endif ?>
    </Feature>

    <!-- UI -->
    <UI />
  </Product>
</Wix>
